# 快速测试指南

## 🚀 快速开始

### 1. 启动后端
```bash
cd backend
python app.py
```

你应该看到：
```
* Running on http://127.0.0.1:5000
```

### 2. 运行调试测试（推荐）
```bash
# 在另一个终端
python backend/tests/test_distill_debug.py
```

这个测试会显示：
- ✅ 后端状态
- 📝 输入文本
- 📊 响应详情
- 🔍 节点和关系详情

### 3. 运行完整测试
```bash
python backend/tests/test_distill_integration.py
```

## 📋 测试文件说明

### test_distill_validation.py
- **用途**: 单元测试，测试验证逻辑
- **不需要后端运行**
- **测试内容**:
  - one-liner 截断
  - 实体类型验证
  - 关系类型验证
  - Schema 完整性

```bash
python backend/tests/test_distill_validation.py
```

### test_distill_debug.py ⭐ 推荐
- **用途**: 调试测试，显示详细信息
- **需要后端运行**
- **测试内容**:
  - 后端健康检查
  - 完整蒸馏流程
  - 详细的响应数据

```bash
python backend/tests/test_distill_debug.py
```

### test_distill_integration.py
- **用途**: 集成测试，完整验证
- **需要后端运行**
- **测试内容**:
  - PRD 合规性
  - Schema 验证
  - 边缘情况

```bash
python backend/tests/test_distill_integration.py
```

## 🔧 故障排除

### 问题 1: "Cannot connect to backend"
**解决方案**:
```bash
# 确保后端正在运行
cd backend
python app.py
```

### 问题 2: "API not configured"
**解决方案**:
1. 检查 `backend/.env` 或根目录 `.env` 文件
2. 确保包含：
   ```
   LLM_API_KEY=your_api_key_here
   LLM_BASE_URL=https://api.deepseek.com/v1
   LLM_MODEL=deepseek-ai/DeepSeek-V3.2-Exp
   ```

### 问题 3: "Failed to parse LLM response"
**可能原因**:
1. LLM 返回了 markdown 格式的 JSON
2. LLM 没有返回有效的 JSON
3. 模型不支持 JSON 输出

**解决方案**:
1. 运行调试测试查看原始响应：
   ```bash
   python backend/tests/test_distill_debug.py
   ```
2. 查看后端日志中的 "LLM raw response"
3. 代码已经添加了自动提取 markdown 中 JSON 的逻辑

### 问题 4: 请求超时
**解决方案**:
1. 检查网络连接
2. 检查 API 密钥是否有效
3. 尝试更快的模型

## 📊 预期输出

### 成功的测试输出
```
============================================================
蒸馏功能调试测试
============================================================

🔍 检查后端状态...
✅ 后端运行正常
   - API 已配置: True
   - LLM 模型: deepseek-ai/DeepSeek-V3.2-Exp

📝 输入文本: 区块链技术通过去中心化的方式解决了数据隐私问题

🔄 发送请求到后端...

📊 响应状态码: 200

✅ 蒸馏成功！

📋 返回的数据结构:
   - one_liner: 区块链通过去中心化保护数据隐私
   - tags: ['区块链', '隐私', '去中心化']
   - summary 长度: 150 字符
   - 节点数量: 3
   - 边数量: 2
   - 嵌入向量维度: 1536

🔍 节点详情:
   1. 区块链技术 (Concept)
   2. 数据隐私 (Problem)
   3. 去中心化 (Methodology)

🔗 关系详情:
   1. node1 --[solves]--> node2
```

### 后端日志（成功）
```
[POST] /api/distill
⏱️  Distilling text: 区块链技术通过去中心化...
   LLM call: 3.45s
   LLM raw response: {"one_liner": "区块链通过去中心化保护数据隐私"...
✅ Schema validation passed: 0.002s
   Embedding call: 0.89s
✅ Total distill time: 4.35s
```

## 💡 提示

1. **先运行调试测试** - 它会给你最详细的信息
2. **查看后端日志** - 所有重要信息都会打印出来
3. **使用中文测试** - 系统支持中文输入
4. **检查 API 配额** - 确保你的 API 密钥有足够的配额

## 🎯 下一步

测试通过后，可以：
1. 在前端界面测试蒸馏功能
2. 继续实现 Task 2（图谱级别管理）
3. 编写可选的属性测试（Task 1.1*, 1.2*）
